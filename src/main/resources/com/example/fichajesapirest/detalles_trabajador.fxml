<?xml version="1.0" encoding="UTF-8"?>

<?import java.net.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>

<!-- ================= ESTRUCTURA PRINCIPAL ================= -->

<VBox alignment="TOP_CENTER" spacing="0" style="-fx-background-color: #f5f5f5;" xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.example.fichajesapirest.DetallesTrabajadorController">
    <!-- ================= ESTILOS ================= -->
    <stylesheets>
        <URL value="@style.css" />
    </stylesheets>

    <!-- ================= ENCABEZADO ================= -->
    <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10; -fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
        <ImageView fitHeight="48" fitWidth="48">
            <Image url="@/logo.jpeg" />
        </ImageView>
        <VBox alignment="CENTER_LEFT">
            <Label style="-fx-font-size: 20px;" styleClass="titulo-principal" text="Sistema de Control de Asistencia" />
            <Label style="-fx-font-size: 16px;" styleClass="subtitulo" text="Detalles del Trabajador" />
        </VBox>
    </HBox>

    <!-- ================= CONTENIDO PRINCIPAL ================= -->
    <VBox VBox.vgrow="ALWAYS" style="-fx-padding: 10;">
        <HBox HBox.hgrow="ALWAYS" spacing="20">
            <!-- ================= PANEL IZQUIERDO: INFORMACIÓN ================= -->
            <VBox maxWidth="350" minWidth="350" prefWidth="350" spacing="20" style="-fx-padding: 0 0 0 20;">
                <!-- Menú desplegable de Información Personal -->
                <TitledPane animated="true" collapsible="true" expanded="false" style="-fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" styleClass="panel-filtros" text="Información Personal">
                    <graphic>
                        <ImageView fitHeight="20" fitWidth="20">
                            <Image url="@/info-icon.png" />
                        </ImageView>
                    </graphic>
                    <content>
                        <GridPane hgap="10" style="-fx-padding: 10;" vgap="8">
                            <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Nombre:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                            <Label fx:id="nombreLabel" style="-fx-font-size: 12px; -fx-font-weight: bold;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                            <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Apellidos:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                            <Label fx:id="apellidosLabel" style="-fx-font-size: 12px; -fx-font-weight: bold;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                            <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="DNI:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                            <Label fx:id="dniLabel" style="-fx-font-size: 12px; -fx-font-weight: bold;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                            <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Horario:" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                            <Label fx:id="horarioLabel" style="-fx-font-size: 12px; -fx-font-weight: bold;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="3" />
                            <columnConstraints>
                                <ColumnConstraints />
                                <ColumnConstraints />
                            </columnConstraints>
                            <rowConstraints>
                                <RowConstraints />
                                <RowConstraints />
                                <RowConstraints />
                                <RowConstraints />
                            </rowConstraints>
                        </GridPane>
                    </content>
                </TitledPane>

                <!-- Menú desplegable de Estadísticas -->
                <TitledPane animated="true" collapsible="true" expanded="false" style="-fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" styleClass="panel-filtros" text="Estadísticas">
                    <graphic>
                        <ImageView fitHeight="20" fitWidth="20">
                            <Image url="@/stats-icon.png" />
                        </ImageView>
                    </graphic>
                    <content>
                        <GridPane hgap="10" style="-fx-padding: 10;" vgap="8">
                            <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Días Trabajados:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                            <Label fx:id="diasTrabajadosLabel" style="-fx-font-size: 12px; -fx-font-weight: bold;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                            <columnConstraints>
                                <ColumnConstraints />
                                <ColumnConstraints />
                            </columnConstraints>
                            <rowConstraints>
                                <RowConstraints />
                            </rowConstraints>
                        </GridPane>
                    </content>
                </TitledPane>

                <!-- Menú desplegable de Horario Laboral -->
                <TitledPane animated="true" collapsible="true" expanded="false" style="-fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" styleClass="panel-filtros" text="Horario Laboral">
                    <graphic>
                        <ImageView fitHeight="20" fitWidth="20">
                            <Image url="@/clock-icon.png" />
                        </ImageView>
                    </graphic>
                    <content>
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <GridPane hgap="10" vgap="8">
                                <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Entrada Mañana:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                <TextField fx:id="horaEntradaMananaField" prefHeight="27.0" prefWidth="115.0" style="-fx-font-size: 12px;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                                <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Salida Mañana:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                <TextField fx:id="horaSalidaMananaField" style="-fx-font-size: 12px;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Entrada Tarde:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                                <TextField fx:id="horaEntradaTardeField" style="-fx-font-size: 12px;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                                <Label style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" text="Salida Tarde:" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                                <TextField fx:id="horaSalidaTardeField" style="-fx-font-size: 12px;" styleClass="campo-busqueda" GridPane.columnIndex="1" GridPane.rowIndex="3" />
                                <columnConstraints>
                                    <ColumnConstraints />
                                    <ColumnConstraints />
                                </columnConstraints>
                                <rowConstraints>
                                    <RowConstraints />
                                    <RowConstraints />
                                    <RowConstraints />
                                    <RowConstraints />
                                </rowConstraints>
                            </GridPane>
                            <HBox alignment="CENTER">
                                <Button fx:id="guardarHorarioButton" onAction="#guardarHorario" style="-fx-min-width: 200; -fx-pref-width: 200;" styleClass="button" text="Guardar Horario">
                                    <graphic>
                                        <ImageView fitHeight="14" fitWidth="14">
                                            <Image url="@/save-icon.png" />
                                        </ImageView>
                                    </graphic>
                                </Button>
                            </HBox>
                        </VBox>
                    </content>
                </TitledPane>

                <!-- Indicadores de estado -->
                <HBox alignment="CENTER" prefHeight="65.0" prefWidth="562.0" spacing="20" style="-fx-padding: 5;">
                    <VBox alignment="CENTER" spacing="5" style="-fx-padding: 8; -fx-background-color: #E8F5E9; -fx-background-radius: 5;">
                        <Label style="-fx-font-size: 12px; -fx-text-fill: #2E7D32;" text="Puntualidad" />
                        <Label fx:id="indicadorPuntualidad" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2E7D32;" text="95%" />
                    </VBox>
                    <VBox alignment="CENTER" spacing="5" style="-fx-padding: 8; -fx-background-color: #FFF3E0; -fx-background-radius: 5;">
                        <Label style="-fx-font-size: 12px; -fx-text-fill: #F57C00;" text="Retrasos" />
                        <Label fx:id="indicadorRetrasos" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #F57C00;" text="3" />
                    </VBox>
                    <VBox alignment="CENTER" spacing="5" style="-fx-padding: 8; -fx-background-color: #FFEBEE; -fx-background-radius: 5;">
                        <Label style="-fx-font-size: 12px; -fx-text-fill: #C62828;" text="Ausencias" />
                        <Label fx:id="indicadorAusencias" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #C62828;" text="1" />
                    </VBox>
                </HBox>
            </VBox>

            <!-- ================= PANEL DERECHO: TABLAS ================= -->
            <VBox HBox.hgrow="ALWAYS" style="-fx-padding: 15; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" styleClass="panel-tabla">
                <!-- Filtros avanzados -->
                <VBox prefHeight="100.0" spacing="5" style="-fx-padding: 10; -fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #333333;" text="Filtros Avanzados" />
                        <MenuButton fx:id="menuFiltrosAdicionales" prefHeight="23.0" prefWidth="123.0" styleClass="menu-button" text="Más Filtros">
                            <items>
                                <CustomMenuItem>
                                    <content>
                                        <VBox spacing="5" style="-fx-padding: 10;">
                                            <Label style="-fx-font-size: 12px; -fx-text-fill: #666666;" text="Tipo de Registro" />
                                            <HBox alignment="CENTER_LEFT" spacing="15">
                                                <CheckBox fx:id="checkEntradas" selected="true" styleClass="checkbox" text="Entradas" />
                                                <CheckBox fx:id="checkSalidas" selected="true" styleClass="checkbox" text="Salidas" />
                                            </HBox>
                                            <Separator style="-fx-padding: 5 0;" />
                                            <Label style="-fx-font-size: 12px; -fx-text-fill: #666666;" text="Estado" />
                                            <HBox alignment="CENTER_LEFT" spacing="15">
                                                <CheckBox fx:id="checkPuntual" selected="true" styleClass="checkbox" text="Puntual" />
                                                <CheckBox fx:id="checkTarde" selected="true" styleClass="checkbox" text="Tarde" />
                                                <CheckBox fx:id="checkAusente" selected="true" styleClass="checkbox" text="Ausente" />
                                            </HBox>
                                        </VBox>
                                    </content>
                                </CustomMenuItem>
                            </items>
                        </MenuButton>
                       <HBox alignment="CENTER_LEFT" prefHeight="72.0" prefWidth="407.0" spacing="20" style="-fx-padding: 5;">
                           <VBox spacing="5" style="-fx-min-width: 200;">
                               <Label style="-fx-font-size: 12px; -fx-text-fill: #666666;" text="Rango de Fechas" />
                               <HBox alignment="CENTER_LEFT" maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="42.0" prefWidth="391.0" spacing="10">
                                   <DatePicker fx:id="fechaInicioPicker" maxHeight="-Infinity" maxWidth="-Infinity" minWidth="75.0" prefHeight="42.0" prefWidth="75.0" styleClass="date-picker" />
                                   <Label style="-fx-text-fill: #666666;" text="a" />
                                   <DatePicker fx:id="fechaFinPicker" minWidth="156.0" prefHeight="42.0" prefWidth="107.0" styleClass="date-picker" />
                               </HBox>
                           </VBox>
                       </HBox>
                    </HBox>
                    <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-padding: 5 0 0 0;">
                        <Button onAction="#limpiarFiltro" prefHeight="32.0" prefWidth="120.0" styleClass="boton-limpiar-filtros" text="Limpiar Filtros">
                            <graphic>
                                <ImageView fitHeight="16" fitWidth="16">
                                    <Image url="@/clear-icon.png" />
                                </ImageView>
                            </graphic>
                        </Button>
                        <Button onAction="#filtrarPorFecha" prefHeight="30.0" prefWidth="120.0" styleClass="button" text="Aplicar Filtros">
                            <graphic>
                                <ImageView fitHeight="16" fitWidth="16">
                                    <Image url="@/filter-icon.png" />
                                </ImageView>
                            </graphic>
                        </Button>
                    </HBox>
                </VBox>

                <!-- Espaciado entre filtros y TabPane -->
                <Region prefHeight="10" />

                <!-- TabPane con las tablas -->
                <TabPane fx:id="tabPane" VBox.vgrow="ALWAYS" styleClass="tab-pane">
                    <tabs>
                        <!-- Pestaña de Entradas -->
                        <Tab closable="false" styleClass="tab">
                            <graphic>
                                <HBox alignment="CENTER" spacing="3" style="-fx-padding: 0 3; -fx-min-width: 100;">
                                    <ImageView fitHeight="14" fitWidth="14" style="-fx-fill: white;">
                                        <Image url="@/entry-icon.png" />
                                    </ImageView>
                                    <Label style="-fx-font-size: 12px; -fx-font-weight: bold;" text="Entradas" />
                                    <MenuButton fx:id="menuEntradas" styleClass="menu-button">
                                        <items>
                                            <MenuItem onAction="#mostrarEntradasManana" text="Mañana" />
                                            <MenuItem onAction="#mostrarEntradasTarde" text="Tarde" />
                                        </items>
                                    </MenuButton>
                                </HBox>
                            </graphic>
                            <content>
                                <StackPane style="-fx-padding: 5;" styleClass="tab-content" VBox.vgrow="ALWAYS">
                                    <TableView fx:id="entradasMananaTableView" maxHeight="400" minHeight="300" prefHeight="350" prefWidth="800" styleClass="table-view" visible="false" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn fx:id="fechaEntradaMananaCol" prefWidth="200.0" styleClass="table-column" text="Fecha y Hora" />
                                            <TableColumn fx:id="tipoEntradaMananaCol" prefWidth="150.0" styleClass="table-column" text="Tipo" />
                                            <TableColumn fx:id="estadoEntradaMananaCol" prefWidth="150.0" styleClass="table-column" text="Estado" />
                                            <TableColumn fx:id="iconosEntradaMananaColumn" prefWidth="100.0" styleClass="table-column" text="Iconos" />
                                        </columns>
                                    </TableView>
                                    <TableView fx:id="entradasTardeTableView" maxHeight="400" minHeight="300" prefHeight="350" prefWidth="800" styleClass="table-view" visible="false" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn fx:id="fechaEntradaTardeCol" prefWidth="200.0" styleClass="table-column" text="Fecha y Hora" />
                                            <TableColumn fx:id="tipoEntradaTardeCol" prefWidth="150.0" styleClass="table-column" text="Tipo" />
                                            <TableColumn fx:id="estadoEntradaTardeCol" prefWidth="150.0" styleClass="table-column" text="Estado" />
                                            <TableColumn fx:id="iconosEntradaTardeColumn" prefWidth="100.0" styleClass="table-column" text="Iconos" />
                                        </columns>
                                    </TableView>
                                </StackPane>
                            </content>
                        </Tab>

                        <!-- Pestaña de Salidas -->
                        <Tab closable="false">
                            <graphic>
                                <HBox alignment="CENTER" spacing="3" style="-fx-padding: 0 3; -fx-min-width: 100;">
                                    <ImageView fitHeight="14" fitWidth="14" style="-fx-fill: white;">
                                        <Image url="@/exit-icon.png" />
                                    </ImageView>
                                    <Label style="-fx-font-size: 12px; -fx-font-weight: bold;" text="Salidas" />
                                    <MenuButton fx:id="menuSalidas" styleClass="menu-button">
                                        <items>
                                            <MenuItem onAction="#mostrarSalidasManana" text="Mañana" />
                                            <MenuItem onAction="#mostrarSalidasTarde" text="Tarde" />
                                        </items>
                                    </MenuButton>
                                </HBox>
                            </graphic>
                            <content>
                                <StackPane style="-fx-padding: 5;" styleClass="tab-content" VBox.vgrow="ALWAYS">
                                    <TableView fx:id="salidasMananaTableView" maxHeight="400" minHeight="300" prefHeight="350" prefWidth="800" styleClass="table-view" visible="false" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn fx:id="fechaSalidaMananaCol" prefWidth="200.0" styleClass="table-column" text="Fecha y Hora" />
                                            <TableColumn fx:id="tipoSalidaMananaCol" prefWidth="150.0" styleClass="table-column" text="Tipo" />
                                            <TableColumn fx:id="estadoSalidaMananaCol" prefWidth="150.0" styleClass="table-column" text="Estado" />
                                            <TableColumn fx:id="iconosSalidaMananaColumn" prefWidth="100.0" styleClass="table-column" text="Iconos" />
                                        </columns>
                                    </TableView>
                                    <TableView fx:id="salidasTardeTableView" maxHeight="400" minHeight="300" prefHeight="350" prefWidth="800" styleClass="table-view" visible="false" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn fx:id="fechaSalidaTardeCol" prefWidth="200.0" styleClass="table-column" text="Fecha y Hora" />
                                            <TableColumn fx:id="tipoSalidaTardeCol" prefWidth="150.0" styleClass="table-column" text="Tipo" />
                                            <TableColumn fx:id="estadoSalidaTardeCol" prefWidth="150.0" styleClass="table-column" text="Estado" />
                                            <TableColumn fx:id="iconosSalidaTardeColumn" prefWidth="100.0" styleClass="table-column" text="Iconos" />
                                        </columns>
                                    </TableView>
                                </StackPane>
                            </content>
                        </Tab>

                        <!-- Pestaña de Calendario -->
                        <Tab closable="false" text="Calendario">
                            <graphic>
                                <HBox alignment="CENTER" spacing="3" style="-fx-padding: 0 3; -fx-min-width: 100;">
                                    <ImageView fitHeight="14" fitWidth="14" style="-fx-fill: white;">
                                        <Image url="@/calendar-icon.png" />
                                    </ImageView>
                                    <Label style="-fx-font-size: 12px; -fx-font-weight: bold;" text="Calendario" />
                                </HBox>
                            </graphic>
                            <content>
                                <VBox spacing="10" style="-fx-padding: 10;" VBox.vgrow="ALWAYS">
                                    <HBox alignment="CENTER" spacing="20" HBox.hgrow="ALWAYS">
                                        <VBox alignment="CENTER" spacing="10" style="-fx-padding: 10; -fx-background-color: white; -fx-background-radius: 5; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2); -fx-max-width: 300;">
                                            <DatePicker fx:id="calendarioTrabajo" prefWidth="250.0" showWeekNumbers="true" styleClass="date-picker">
                                                <VBox.margin>
                                                    <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                                                </VBox.margin>
                                            </DatePicker>
                                            <Label style="-fx-font-size: 12px;" styleClass="subtitulo" text="Días trabajados este mes:" />
                                            <Label fx:id="diasTrabajadosCalendarioLabel" style="-fx-font-size: 14px; -fx-text-fill: #2E7D32;" styleClass="etiqueta-filtro" />
                                        </VBox>
                                        <VBox spacing="10" style="-fx-padding: 15; -fx-min-width: 300; -fx-max-width: 400;" styleClass="panel-filtros" VBox.vgrow="ALWAYS">
                                            <Label style="-fx-font-size: 14px;" styleClass="subtitulo" text="Resumen Mensual" />
                                            <Label fx:id="resumenMensualLabel" style="-fx-font-size: 12px;" styleClass="etiqueta-filtro" wrapText="true" />
                                        </VBox>
                                    </HBox>
                                </VBox>
                            </content>
                        </Tab>
                    </tabs>
                </TabPane>
            </VBox>
        </HBox>

        <!-- ================= BOTONES DE ACCIÓN ================= -->
        <HBox alignment="CENTER" spacing="20" style="-fx-padding: 10 0 5 0;">
            <Button fx:id="exportarButton" onAction="#exportarDatos" styleClass="button" text="Exportar">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/export-icon.png" />
                    </ImageView>
                </graphic>
            </Button>
            <Button fx:id="cerrarButton" onAction="#cerrarVentana" styleClass="button" text="Cerrar">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16">
                        <Image url="@/close-icon.png" />
                    </ImageView>
                </graphic>
            </Button>
        </HBox>
    </VBox>

    <!-- ================= PIE DE PÁGINA ================= -->
    <HBox alignment="CENTER" style="-fx-padding: 5; -fx-background-color: white; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
        <Label style="-fx-font-size: 11px;" styleClass="etiqueta-filtro" text="© 2024 Sistema de Control de Asistencia - Versión 1.0" />
    </HBox>
</VBox>
